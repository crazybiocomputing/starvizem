<!DOCTYPE html>
<html>

<head>
  <meta charset="utf8">
  <title>Test Arc Diagram</title>
  <script src="http://d3js.org/d3.v5.js"></script>
  <script src="../js/common.js"></script>
  <script src="../js/arcDiagram.js"></script>
  <script src="../js/barChart.js"></script>
  <script src="../js/donut.js"></script>

  <script type="text/javascript">
  const createGraph = (rootID, width, height) => {
    // Get JSON data from web service
    d3.json('/pipeline')
      .then(function(graph) {
        let datas = graph.jobs;
        console.log(datas);
        let data = {};
        let data_node = [];
        let data_link = [];
        datas.forEach( (d) => {
          let temp_node = {
            id: d.jobID,
            process: d.process,
            value: d.targets.length
          };
          data_node.push(temp_node);
          if (d.targets.length !== 0) {
            d.targets.forEach( (t) => {
              let val;
              let temp_link = {
                source: d.jobID,
                value: d.targets.length,
                target: t
              };
/*
              if (d.targets != []) {
                  val = t;
              } else {
                  val = d.jobID;
              }
              temp_link["target"] = val;
              */
              data_link.push(temp_link);
            });
          }
        });

        data["node"] = data_node;
        data["links"] = data_link;
        console.log(data);
        document.body.appendChild(createArcDiagram(data, width, height));
      });

  };
  </script>
</head>

<body onload="createGraph('root',1600,400);">
    <h1>Tests of StarVizEM - Arc Diagram</h1>

    <content id="root"></content>

</body>

</html>

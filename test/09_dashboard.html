<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">  
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="HandheldFriendly" content="true">
    <title>StarViZem</title>
    <script src="../javascripts/d3.js"></script>
    <script src="http://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">
    <link rel="stylesheet" href="09_dashboard.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/arcDiagram.js"></script>
    <script src="../js/barChart.js"></script>
    <script src="../js/stacked_barchart.js"></script>
    <script src="../js/donut.js"></script>
    <script src="../js/plot1D.js"></script>
    <script src="../js/plot2D.js"></script>
    <script src="../js/mrc.js"></script>
    <script src="../js/raster.js"></script>
    <script src="../js/events.js"></script>
  </head>
  <body onload="createForm()">
    <section id="head" class="hero  is-primary">
      <div class="hero-body">
        <div  id="box" class="container">
          <h1 id="txt" class="title">StarVizEM</h1>
          <p id="txt" class="subtitle">A collection of tests for exploring various <strong>STAR Files</strong> generated by Relion.</p>
        </div>
      </div>
    </section>
    <header>
    <section id="arcDiag"></section>  
    <h3 style="display: inline;text-decoration:underline;font-weight:bold; margin-left:2%">Show Images:</h3>
    <input type='file' id='fileinput' >
    <input style="display: inline" type='button' id='btnLoad' value='Load' onclick='loadFile();'>
    </form>
    <br />
    <section id ="graphsection">
        <div id="graph1"></div>
        <div id="graph2"></div>
        <div id="graph3"></div>
    </section>
    <form id="getPlot" action="" method="post" style="margin-left: 2%;display: inline-block">
    <h2 style="text-decoration:underline;font-weight:bold;display: inline-block">Table:</h2>  
    <select id="table" name="table" onchange="changeTableHandler(event)">
    <option>----</option>
    </select>
    <select id="colX" name="colX">
    <option>----</option>
    <option value="_svzRowNumber">_svzRowNumber</option>
    </select>
    <select id="colY" name="colY">
    <option>----</option>
    </select>
    <button type="submit">Draw Plot</button>
     <input onclick='window.location.reload(false)' type="reset" value="Reset"/>
    </form>
    <form id="keywords">
    </form>
    </header>
    <section id ="plotSection">
        <div id="plot1"></div>
        <div id="plot2"></div>
    </section>
  <script type="text/javascript">
  // Global variable
  let workflow;
  let starobj;
    
  let plotForm = document.getElementById("getPlot");
   plotForm.addEventListener("submit", (event) => {
    event.preventDefault();
    drawPlot();
  });
    
  const clickEvents = () => {
    let graph1 = document.getElementById('graph1');
    let arcs = document.getElementsByClassName("arc");
    let bars = document.getElementsByClassName("bar");
    console.log(arcs);
    for (let i=0; i < arcs.length; i++){
      console.log(arcs[i].id);
      arcs[i].addEventlistener("click", highlightItems("graph2"));
    }
    for (let i=0; i< bars.length; i++){
      bars[i].addEventlistener("click", highlightItems("graph1"));
    }
  }
  
  // Onload get default_pipeline.star and create form items
  const createForm = () => {
    console.log('createForm');
    d3.json('/pipeline')
      .then( (graph) => {
        workflow = graph;
        createArcDiagrams('arcDiag',graph);
      });
  };
    
  // Onload get default_pipeline.star and create form items
  const createXYForm = (obj) => {
    console.log('createXYForm');
    
    let set = new Set();
    obj.tables.forEach( (table)=> {
      set.add(table.name);
    });
    console.log(set);
    let select = document.getElementById('table');
    for (p of set) {
      let opt = document.createElement('option');
      opt.value = p;
      opt.text = p;
      select.appendChild(opt);
    }
  };  
    
    
/*
*Highlight the graphs elements that are commons
*/
const highlightItems = (id) => {
  let parent = document.getElementById(id);
  //Browse the DOM
  for (let i = 0; i < parent.childNodes.length; i++) {
    let child = parent.childNodes[i];
    console.log(child);
    if (child.style.opacity == "0.5"){child.style.opacity = "1";};
    if (child.id == this.id){
      console.log("same id found "+this.id +" " + child.id);
      child.style.opacity = "0.5";
      this.style.opacity = "0.5";
    } 
  }
}

const setupListeners = () => {
  arcs.addEventlistener("click", highlightItems(e));
  bars.addEventlistener("click", highlightItems(e));
} 
  </script>
 <section >
    <footer id="bas" class="footer">
     <div id="box" class="container">
       <div class="content has-text-centered">
         <p id="txtBottom">
           <strong>StarVizEM</strong> by Jean-Christophe Taveau.</p> </br></br> <p>The source code is licensed GPLv3.0. The website content
           is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.</p>
         </p>
         <p id="txtBottom"><strong>Contributors</strong>: Pauline Bock, Cyril Dourthe, Marie Econimides, Guillaume Sotton.</p>
        </br></br>
         <p id="txtBottom">
           <span class="tag is-dark">STAR Files</span>
           <span class="tag is-dark">cryoEM</span>
           <span class="tag is-dark">RELION</span>
           <span class="tag is-dark">ES2015+</span>
           <span class="tag is-dark">Node.js</span>
           <span class="tag is-dark">HTML5</span>
           <span class="tag is-dark">CSS3</span>
           <span class="tag is-dark">D3.js</span>
         </p>
       </div>
     </div>
   </footer>
 </section>
  </body>
</html>
